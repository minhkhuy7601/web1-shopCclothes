<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thanh toán</title>
    <link rel="stylesheet" href="/vendor/bootstrap-4.5.3-dist/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="/vendor/bootstrap-4.5.3-dist/js/bootstrap.min.js"></script>
    <script src="https://kit.fontawesome.com/a076d05399.js"></script>
    <link rel="stylesheet" href="/resource/css/general.css">
    <style>
        #container_box {
            display: flex;
            width: 80%;
            margin: 3rem auto;
            justify-content: space-around;
        }
        
        #infoIndent {
            width: 45%;
            border-right: 1px solid rgba(17, 45, 78, .3);
            background-color: rgba(63, 114, 175, .2);
            height: max-content;
            padding: 1rem 4rem;
        }
        
        #payment_box {
            /* padding-left: 4rem;
            padding-right: 4rem; */
            padding: 1rem 4rem;
            /* padding: 4rem 0; */
            width: 45%;
            background-color: rgba(17, 45, 78, .1);
            border-right: 1px solid rgba(17, 45, 78, .3);
            height: max-content;
        }
        
        .input {
            display: block;
            width: 90%;
            margin: 1.5rem auto;
            height: 4rem;
            font-size: 1.5rem;
            border-radius: 0.5rem;
            border: 1px solid rgba(17, 45, 78, .3);
            padding-left: 2rem;
        }
        
        #section {
            padding-top: 4rem;
        }
        
        h2 {
            font-size: 2rem;
            font-weight: 700;
            width: 100%;
            text-align: center;
            padding: 1.5rem 0;
            border-bottom: 1px dashed rgba(17, 45, 78, .3);
        }
        
        .textarea {
            height: 7rem;
        }
        
        #infoCart {
            border-bottom: 1px solid rgba(17, 45, 78, .3);
            padding: 1.5rem 0;
            /* height: 34pt; */
        }
        
        .product {
            display: flex;
            padding: 0.5rem 0;
            border-bottom: 1px dotted rgba(17, 45, 78, .3);
            /* height: 100rem; */
            /* justify-content: space-around; */
            /* border: 1px solid red; */
            height: 7.8rem;
        }
        
        #img {
            width: 15%;
            position: relative;
        }
        
        #img span {
            position: absolute;
            right: -1rem;
            top: -.3rem;
            padding: .2rem .8rem;
            color: white;
            font-size: 1.3rem;
            border-radius: 50%;
            background-color: rgba(63, 114, 175, 1);
        }
        
        #infoProduct {
            width: 65%;
            padding-left: 1.5rem;
        }
        
        .priceProduct {
            width: 20%;
            color: rgba(17, 45, 78, .6);
        }
        
        img {
            width: 100%;
        }
        
        #nameProduct,
        .priceProduct {
            font-size: 1.5rem;
            font-weight: 400;
            display: flex;
            align-items: center;
        }
        
        #describeProduct {
            font-size: 1.2rem;
            opacity: .5;
        }
        
        #couponDiscount {
            display: flex;
            width: 100%;
            margin: 0 auto;
            justify-content: space-around;
            font-size: 1.5rem;
            border-bottom: 1px solid rgba(17, 45, 78, .3);
            padding: 1.5rem 0;
        }
        
        #couponDiscount input {
            width: 75%;
            height: 4rem;
            border-radius: 0.5rem;
            padding-left: 2rem;
            border: 1px solid rgba(17, 45, 78, .3);
        }
        
        #couponDiscount button {
            width: 20%;
            height: 4rem;
            border-radius: 0.5rem;
            background-color: rgba(63, 114, 175, .7);
            color: white;
        }
        
        #pay {
            padding: 1.5rem 0;
            border-bottom: 1px solid rgba(17, 45, 78, .3);
        }
        
        #paymentInfo,
        #totalCash {
            display: flex;
            width: 100%;
            margin: 0 auto;
        }
        
        #text {
            width: 80%;
            font-size: 1.5rem;
        }
        
        #textTotal {
            width: 80%;
            font-size: 2rem;
        }
        
        #priceProductTotal {
            width: 20%;
            font-size: 2rem;
            color: rgba(63, 114, 175, 1);
        }
        
        #btn-func {
            width: 100%;
            display: flex;
        }
        
        #btn-func a {
            width: 80%;
            font-size: 1.6rem;
        }
        
        #btn-func button {
            width: 20%;
            font-size: 1.6rem;
            padding: 0.5rem 0;
            border-radius: 0.5rem;
            background-color: rgba(17, 45, 78, .8);
            color: white;
            text-transform: uppercase;
        }
        
        #totalCash {
            padding: 1rem 0;
        }
    </style>
</head>

<body>
    <header class="header">
        <div class="nav">
            <div class="nav__content">
                <a href="/resource/html/index.html"><img src="/img/logo.png" alt="logo" class="video_logo"></a>
                <div class="nav__content--icon">
                    <i class="fa fa-search icon icon__search">
                    <div action="" class="search">
                            <input type="text" placeholder="Tìm kiếm..." id="box_search">
                            <button type="submit" id="btn_search" onclick=""><i class="fa fa-search btn--search"></i></button>
                </div>
                </i>

                <a href="/resource/html/account.html" class="icon"><i class="fa fa-user"></i></a>
                <a href="/resource/html/cart.html" class="icon cart-head" id="boxNotification">
                    <img src="/img/cart-icon.png" alt="">
                    <span class="cart-count">0</span>
                </a>
            </div>
            <div class="nav__content--bar">
                <ul class="menu" id="menu-header">

                    <li>
                        <a href="/resource/html/genreProduct.html" onclick="getGenre('shop','null')">shop</a>
                        <ul class="menu__sub">
                            <li>
                                <a href="/resource/html/genreProduct.html" onclick="getGenre('top','null')">tops</a>
                                <ul class="menu__sub--s menu__sub--s1">
                                    <li><a href="/resource/html/genreProduct.html" onclick="getGenre('top','t_shirt')">t-shirt</a></li>
                                    <li><a href="/resource/html/genreProduct.html" onclick="getGenre('top','hoodie')">hoodies</a></li>
                                    <li><a href="/resource/html/genreProduct.html" onclick="getGenre('top','jacket')">jackets</a></li>
                                </ul>
                            </li>
                            <li>
                                <a href="/resource/html/genreProduct.html" onclick="getGenre('bottom','null')">bottom</a>
                                <ul class="menu__sub--s menu__sub--s2">
                                    <li><a href="/resource/html/genreProduct.html" onclick="getGenre('bottom','pant')">pants</a></li>
                                    <li><a href="/resource/html/genreProduct.html" onclick="getGenre('bottom','short')">shorts</a></li>
                                    <li><a href="/resource/html/genreProduct.html" onclick="getGenre('bottom','jean')">jeans</a></li>
                                </ul>
                            </li>
                            <li>
                                <a href="/resource/html/genreProduct.html" onclick="getGenre('bag','null')">bags</a>
                                <ul class="menu__sub--s menu__sub--s3">
                                    <li><a href="/resource/html/genreProduct.html" onclick="getGenre('bag','backpack')">backpacks</a></li>
                                    <li><a href="/resource/html/genreProduct.html" onclick="getGenre('bag','bowler_bag')">bowler bags</a></li>

                                </ul>
                            </li>
                        </ul>
                    </li>
                    <li><a href="#">about</a></li>
                    <li><a href="#">collections</a></li>
                    <li><a href="#">blogs</a></li>
                    <li><a href="#">contact</a></li>
                    <li><a href="#">sale!</a></li>


                </ul>
            </div>
        </div>
        </div>
        <!-- <div id="btn-addRemoveProduct">
            <div class="Re_Add btn-add">
                XXX
                <ul>
                    <li><a href="/resource/html/addProduct_Admin.html">ADD PRODUCT</a></li>
                    <li><a href="/resource/html/admin.html">REMOVE PRODUCT</a></li>
                    <li>ADD DISCOUNT</li>
                </ul>
            </div>
        </div> -->
    </header>
    <section id="section">

    </section>
    <footer class="footer">
        <div class="modal fade" id="myModal" role="dialog">
            <div class="modal-dialog" id="modal-discount">
                <div class="modal-content" id="modal-content-discount">
                    <input id="nameDisccount" type="text" placeholder="Tên mã giảm giá">
                    <input id="CostDisscont" type="text" placeholder="Số tiền giảm giá">
                    <input id="amountDisscount" type="text" placeholder="Số lượng mã">
                    <input id="codeDisscount" type="text" placeholder="Nhập mã code...(Tối da 10 ký tự)">
                    <div id="btnModalDiscount">
                        <button type="button" data-dismiss="modal">Close</button>
                        <button type="button" id="yesSetDisscont" onclick="setDiscount()">yes</button>
                    </div>

                </div>
            </div>
        </div>
        <div class="row footer__row">
            <div class="col-sm-4">
                <div class="col2">
                    <h2 class="footer__col--title">Hệ thống cửa hàng</h2>
                    <ul class="menu--address">
                        <li>
                            <i class="fas fa-map-marker-alt"></i> Chi nhánh Hà Nội
                        </li>
                        <p>
                            121 Phố Huế, Hai Bà Trưng, Hà Nội <br> Tầng 7 Vincom Bà Triệu, Hai Bà Trưng, Hà Nội <br> 28 Khúc Thừa Dụ, Dịch Vọng, Cầu Giấy
                        </p>
                        <li>
                            <i class="fas fa-map-marker-alt"></i> Chi nhánh Hồ Chí Minh
                        </li>
                        <p>
                            41 Quang Trung, Phường 10, Quận Gò Vấp, TP.Hồ Chí Minh <br> 7 Huỳnh Khương Ninh, Phường Đakao, Quận 1, TP. Hồ Chí Minh <br> 132 Nguyễn Sơn, Phường Phú Thọ Hòa, Quận Tân Phú, TP.Hồ Chí Minh <br> 136 Nguyễn Hồng Đào, Phường 14
                            , Tân Bình , TP. Hồ Chí Minh
                        </p>
                        <li><i class="fas fa-map-marker-alt"></i> Chi nhánh Cần Thơ
                        </li>
                        <p>52 Mậu Thân Ninh Kiều - Cần Thơ</p>
                        <li><i class="fas fa-map-marker-alt"></i> Chi nhánh An Giang</li>
                        <p><i class="fas fa-phone"></i> 0377738029 <br><i class="fa fa-envelope"></i> minhkhuy7601@gmail.com</p>
                    </ul>
                </div>
            </div>
            <div class="col-sm-4">
                <div class="col1">
                    <div class="footer_box--logo">
                        <img src="/img/logoWhite1.png" alt="logo" class="footer--logo">
                        <div class="footer__content">Lorem ipsum, dolor sit amet consectetur adipisicing elit. Repudiandae, quidem?</div>
                        <div style=" margin: 1rem;  font-size: 1.8rem; padding: 0 2rem;">
                            <input id="feedback" type="text" style="width: 35rem; height: 5rem; padding: 0 2rem;" placeholder="Đóng góp ý kiến...">
                            <button style=" height: 5rem; padding: 0 1rem;  font-weight: 600;">Send</button>

                        </div>
                    </div>
                </div>
            </div>
            <div class="col-sm-4">
                <div class="col3">
                    <h2 class="footer__col--title">Mạng xã hội</h2>
                    <img src="/img/fb_icon.png" alt="fb">
                    <a href="https://www.instagram.com/dirtycoins.vn/?hl=vi"><img src="/img/insta_icon.png" alt=""></a>
                    <img src="/img/pin.png" alt="">
                    <a href="https://www.youtube.com/channel/UCxLwKCNi6FoZ0lKu6k3qFGA"><img src="/img/yt.png" alt=""></a><br><br><br>
                    <iframe src="https://www.facebook.com/plugins/page.php?href=https%3A%2F%2Fwww.facebook.com%2FDirtyCoins.VN&tabs&width=340&height=214&small_header=false&adapt_container_width=true&hide_cover=false&show_facepile=true&appId" width="340" height="214" style="border:none;overflow:hidden"
                        scrolling="no" frameborder="0" allowTransparency="true" allow="encrypted-media"></iframe>
                </div>
            </div>
        </div>
        <div class="author">Web1 @ 2020 by NTK</div>

    </footer>

    <script src="/resource/js/data.js"></script>
    <script src="/resource/js/country.js"></script>
    <script>
        onLoadCartNumbers();

        function display() {
            document.getElementById("section").innerHTML = `<div id="container_box">
            <div id="infoIndent">
                <h2>Thông tin đơn hàng</h2>
                <input type="text" placeholder="Email" class="input" id="email">
                <input type="text" placeholder="Họ và tên" class="input" id="nameCustomer">
                <input type="text" placeholder="Số điện thoại" class="input" id="numPhone">
                <input type="text" placeholder="Địa chỉ" class="input" id="addressDetail">
        
                <select name="state" id="countySel" size="1" class="input">
                    <option value="Tỉnh Thành" selected="selected">Tỉnh Thành</option>
                </select>
        
                <select name="countrya" id="stateSel" size="1" class="input">
                    <option value="Quận Huyện" selected="selected">Quận Huyện</option>
                </select>
       
                <select name="district" id="districtSel" size="1" class="input">
                     <option value="Phường Xã" selected="selected">Phường Xã</option>
                </select>
        
    
            
                <textarea name="" id="note" placeholder="Ghi chú (tùy chọn)" class="input textarea" style="resize: none;" cols="30" rows="10"></textarea>
            </div>
            <div id="payment_box">
                <h2>Đơn hàng</h2>
                <div id="infoCart">
                </div>
                <div id="couponDiscount">
                    <input type="text" id="getDisscount" placeholder="Nhập mã giảm giá">
                    <button  onclick="getDisscount()">Áp dụng</button>
                </div>
                <div id="pay">
                    <div id="paymentInfo">
                        <div id="text">Tạm tính</div>
                        <div class="priceProduct" id="priceTotalTemp"></div>
                    </div>
                    <div id="paymentInfo">
                        <div id="text">Vận chuyển (Thanh toán khi nhận hàng)</div>
                        <div class="priceProduct" id="priceTrans"></div>                     
                    </div>
                    <div id="paymentInfo">
                        <div id="text" class="nameDiscount"></div>
                        <div class="priceProduct" id="priceDisscount"></div>
                    </div>
                </div>
                <div id="totalCash">
                    <div id="textTotal">Tổng cộng</div>
                    <div id="priceProductTotal"></div>
                </div>
                <div id="btn-func">
                    <a href="/resource/html/cart.html">Quay lại giỏ hàng</a>
                    <button onclick="Buy()">Đặt hàng</button>
                </div>
            </div>
        </div>`
            let infoCart = document.getElementById("infoCart");
            let totalCost = 0;
            let trans = 15000;

            for (let i = 0; i < currentAccount.cartTemp.length; i++) {
                totalCost += currentAccount.cartTemp[i].incart * currentAccount.cartTemp[i].price;
                infoCart.innerHTML += `<div class="product">
                        <div id="img"><img src="${currentAccount.cartTemp[i].img}" alt=""><span>${currentAccount.cartTemp[i].incart}</span></div>
                        <div id="infoProduct">
                            <div id="nameProduct">${currentAccount.cartTemp[i].name}</div>
                            <div id="describeProduct"></div>
                        </div>
                        <div class="priceProduct">${currentAccount.cartTemp[i].incart*currentAccount.cartTemp[i].price}₫</div>
                    </div>`
            }
            document.getElementById("priceTotalTemp").textContent = totalCost + "₫";
            document.getElementById("priceTrans").textContent = trans + "₫";
            document.getElementById("priceProductTotal").textContent = totalCost + trans + "₫";
        }

        window.onload = function() {
            let countryIndex, stateIndex, dictrictIndex;
            var countySel = document.getElementById("countySel"),
                stateSel = document.getElementById("stateSel"),
                districtSel = document.getElementById("districtSel");
            for (var country in data) {
                countySel.options[countySel.options.length] = new Option(data[country]["name"], country);
            }
            countySel.onchange = function() {

                stateSel.length = 1; // remove all options bar first
                districtSel.length = 1; // remove all options bar first
                if (this.selectedIndex < 1) return; // done
                for (var state in data[countySel.value]["QuanHuyen"]) {
                    stateSel.options[stateSel.options.length] = new Option(data[countySel.value]["QuanHuyen"][state]["name"], state);
                }
            }
            countySel.onchange(); // reset in case page is reloaded
            stateSel.onchange = function() {
                districtSel.length = 1; // remove all options bar first
                if (this.selectedIndex < 1) return; // done

                for (var district in data[countySel.value]["QuanHuyen"][stateSel.value]["XaPhuong"]) {
                    districtSel.options[districtSel.options.length] = new Option(data[countySel.value]["QuanHuyen"][stateSel.value]["XaPhuong"][district]["name"], district);
                }
                console.log(data[countySel.value]["name"]);
            }

        }

        function scrollProduct() {
            let productIndent = document.querySelectorAll(".product");
            let infoCart = document.getElementById("infoCart");
            // console.log(heighProduct[0].offsetHeight);
            // console.log(productIndent.length);
            // console.log(productIndent[0].offsetHeight);
            if (productIndent.length > 3) {
                infoCart.style.height = (productIndent[0].offsetHeight + 6) * 3 + "px";
                infoCart.style.overflowY = "scroll";

            }
        }

        function getDisscount() {

            let codeDisscount = document.getElementById("getDisscount").value;
            // console.log(listDiscount);
            let bool = true;

            for (let i = 0; i < listDiscount.length; i++) {
                if (listDiscount[i].code == codeDisscount) {
                    if (listDiscount[i].amount <= 0) {
                        alert("Mã đã hết lượt sử dụng");
                        break;
                    }
                    for (let j = 0; j < listDiscount[i].user.length; j++) {
                        if (listDiscount[i].user[j] == currentAccount.idAccount) {
                            alert("Mã đã qua sử dụng");
                            bool = false;
                            break;
                        }

                    }
                    if (bool == true) {
                        let priceProductTotal = document.getElementById("priceProductTotal").textContent;
                        priceProductTotal = priceProductTotal.slice(0, priceProductTotal.length - 1);
                        // listDiscount[i].user.push(currentAccount.idAccount);
                        // listDiscount[i].amount -= 1;
                        alert("Sử dụng thành công mã" + listDiscount[i].name);
                        document.getElementsByClassName("nameDiscount")[0].textContent = "Mã " + listDiscount[i].name;
                        document.getElementById("priceDisscount").textContent = "-" + listDiscount[i].cost + "₫";
                        document.getElementById("priceProductTotal").textContent = priceProductTotal - listDiscount[i].cost + "₫";
                        break;
                    }
                }
            }
            // let disscount = document.getElementById("priceDisscount").textContent;
            // disscount = parseInt(disscount);
            // console.log(disscount);
            // document.getElementById("priceProductTotal").textContent = totalCost + trans - disscount + "₫";

            localStorage.setItem('listDiscount', JSON.stringify(listDiscount));


        }

        function Buy() {
            let arrtmp = [];
            let discount = {};
            let flagBuy = true;
            var today = new Date();
            var date = today.getFullYear() + '-' + (today.getMonth() + 1) + '-' + today.getDate();
            var time = today.getHours() + ":" + today.getMinutes() + ":" + today.getSeconds();
            var dateTime = date + ' ' + time;
            let state = "";
            let nameCustomer = document.getElementById("nameCustomer").value;
            let numPhone = document.getElementById("numPhone").value;
            let email = document.getElementById("email").value;
            let note = document.getElementById("note").value;
            let addressDetail = document.getElementById("addressDetail").value;
            let province = document.getElementById("countySel").value;
            let district = document.getElementById("stateSel").value;
            let village = document.getElementById("districtSel").value;
            // console.log(dictrict + state + countySel);

            // numPhone = parseInt(numPhone);
            console.log(Number.isInteger());
            if (nameCustomer == '' || numPhone == '' || addressDetail == '' || province == 'Tỉnh Thành' || district == 'Quận Huyện' || village == 'Phường Xã') {
                alert('Điền đầy đủ thông tin cần thiết!!(tên, số điện thoại, địa chỉ');
                flagBuy = false;
            } else {
                if (numPhone.length != 10) {
                    alert("Nhập lại số điện thoại");
                    flagBuy = false;
                } else {
                    for (let i = 0; i < numPhone.length; i++) {
                        if (numPhone.charAt(i) < '0' || numPhone.charAt(i) > '9') {
                            alert("Nhập lại số điện thoại");
                            flagBuy = false;
                            break;
                        }
                    }
                }


            }
            if (flagBuy == true) {
                let address = document.getElementById("addressDetail").value + " " + data[countySel.value]["QuanHuyen"][stateSel.value]["XaPhuong"][districtSel.value]["name"] + " " + data[countySel.value]["QuanHuyen"][stateSel.value]["name"] + " " + data[countySel.value]["name"];
                let codeDisscount = document.getElementById("getDisscount").value;
                let priceTotalTemp = document.getElementById("priceTotalTemp").textContent;
                let priceTrans = document.getElementById("priceTrans").textContent;
                let priceProductTotal = document.getElementById("priceProductTotal").textContent;
                let flag = true;
                priceTotalTemp = priceTotalTemp.slice(0, priceTotalTemp.length - 1);
                priceTrans = priceTrans.slice(0, priceTrans.length - 1);
                priceProductTotal = priceProductTotal.slice(0, priceProductTotal.length - 1);
                for (let i = 0; i < listDiscount.length; i++) {
                    if (listDiscount[i].code == codeDisscount) {
                        for (let j = 0; j < listDiscount[i].user.length; j++) {
                            if (listDiscount[i].user[j] == currentAccount.idAccount) {
                                flag = false;
                                break;
                            }
                        }
                        if (flag == true) {
                            listDiscount[i].user.push(currentAccount.idAccount);
                            listDiscount[i].amount -= 1;
                            discount.nameDiscount = listDiscount[i].name;
                            discount.priceDiscount = listDiscount[i].cost;
                            discount.codeDiscount = listDiscount[i].code;
                            localStorage.setItem('listDiscount', JSON.stringify(listDiscount));
                        }
                    }

                }

                alert("Cảm ơn quý khách đã mua sản phẩm ^^!!!");
                for (let i = 0; i < currentAccount.cartTemp.length; i++) {
                    arrtmp.push(currentAccount.cartTemp[i]);
                }

                currentAccount.cart.push({
                    priceTotalTemp: priceTotalTemp,
                    priceTrans: priceTrans,
                    priceProductTotal: priceProductTotal,
                    address: address,
                    nameCustomer: nameCustomer,
                    numPhone: numPhone,
                    email: email,
                    note: note,
                    idIndent: currentAccount.idAccount + makeid(),
                    stateDisplay: false,
                    state: "Chờ xác nhận",
                    dateBuy: dateTime,
                    seen: false,
                    product: arrtmp,
                    discount: discount
                });
                accounts[1].notice.push(currentAccount.cart[currentAccount.cart.length - 1]);
                currentAccount.cartTemp.splice(0);
                accounts[currentAccount.id] = currentAccount;
                localStorage.setItem('allAccount', JSON.stringify(accounts));
                localStorage.setItem('currentAccount', JSON.stringify(currentAccount));
                displayCartNumbers();
                window.location.href = "/resource/html/account.html";
            }

        }
        display();
        scrollProduct();
    </script>
</body>

</html>